# Comparing OS and libraries on Apple M3

The directory contains results for `aesbench` on the Apple M3 chip with various
operating systems and different versions of the cryptographic libraries.

## Test environment

The test environment is one single iMac M3 with the following configurations:

- Host macOS 15.3 and OpenSSL 3.4.1 (installed by Homebrew).
- VM Linux Ubuntu 24.10 and OpenSSL 3.3.1 (installed with Ubuntu).
- VM Linux Ubuntu 24.10 and OpenSSL 3.4.1 (recompiled from sources).
- VM Windows 11 24H2 and OpenSSL 3.4.1 (installed from https://slproweb.com/).

The hypervisor is Parallels Desktop 20.2.0.

## Hardware acceleration

OpenSSL takes advantage, when possible, of specialized instructions for AES
and vector processing. This is done according to the CPU capabilities which
are recognized by OpenSSL at runtime. The capabilities are encoded in a bitmask
named "CPU info". Here are the displayed values for this bitmask:

- Linux / GCC: CPUINFO: OPENSSL_armcap=0x8fd
- macOS / clang: CPUINFO: OPENSSL_armcap=0x987d
- Windows / Visual Studio: CPUINFO: N/A

With the same version of OpenSSL (3.4.1), on the same processor, we see that the
macOS version recognizes a different set of capabilities, 0x987d vs. 0x8fd on Linux.

The Windows version seems to recognize no CPU capability at all. If no hardware
acceleration is used at all, this may explain the catastrophic results with OpenSSL
on Windows.

## Conclusions

- The macOS version is marginally better by less than 1%. We may assume that the code
  which is generated by clang on macOS is slightly better than using gcc on Linux.
- There is a more important difference on AES-GCM. The topic should be analyzed more
  in depth. Again, the code generation of clang is maybe better in substituting complex
  sequences of instructions into specialized instructions.
